<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vallejo Paint Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="data.js"></script>
    <style>.paint-group{border:1px solid #d1d5db;border-radius:4px;padding:0.5rem;margin-bottom:0.5rem}.paint-swatch{border:1px solid #e5e7eb;border-radius:4px;padding:0.5rem;background:white}.color-block{aspect-ratio:2.975/1;border:1px solid #d1d5db;border-radius:4px;cursor:pointer}</style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState: u, useEffect: e, useMemo: m, useCallback: c } = React;

        function ep(p){const b=new Uint8Array(Math.ceil(p.length/4));p.forEach((a,i)=>{const x=Math.floor(i/4),o=(i%4)*2,s=a.owned?2:a.toBuy?1:0;b[x]|=s<<o});return btoa(String.fromCharCode(...b))}
        function dp(s,p){try{const b=atob(s),a=new Uint8Array(b.length);for(let i=0;i<b.length;i++)a[i]=b.charCodeAt(i);return p.map((e,i)=>{const x=Math.floor(i/4),o=(i%4)*2,v=(a[x]>>o)&3;return{...e,owned:v===2,toBuy:v===1}})}catch{return p}}
        function dl(s,p){try{const j=JSON.parse(atob(s)),o=new Set(j.owned||[]),t=new Set(j.toBuy||[]);return p.map(e=>({...e,owned:o.has(e.idx),toBuy:t.has(e.idx)}))}catch{return p}}
        function ds(s,p){try{const d=atob(s);if(d.startsWith('{')||d.startsWith('['))return dl(s,p)}catch{}return dp(s,p)}

        function App() {
            const [p, sP] = u(() => {
                try {
                    const s = localStorage.getItem('vallejo-paint-data');
                    if (s) {
                        const d = JSON.parse(s), o = new Set(d.owned || []), t = new Set(d.toBuy || []);
                        return window.paintData.map(e => ({ ...e, owned: o.has(e.id), toBuy: t.has(e.id) }));
                    }
                } catch {}
                return window.paintData.map(e => ({ ...e, owned: false, toBuy: false }));
            });
            const [s, sS] = u('');
            const [t, sT] = u(false);
            const [f, sF] = u(false);
            const [fl, sFl] = u({ owned: false, notOwned: false, toBuy: false });
            const [st, sSt] = u('');
            const [sm, sSm] = u(false);
            const [lc, sLc] = u(false);
            const [rc, sRc] = u(false);
            const [h, sH] = u('');
            const [mc, sMc] = u('');
            const [hl, sHl] = u(false);

            const pt = ["Regular", "Metallic", "Ink", "Wash", "Fluo", "Special FX", "Auxiliary", "Xpress", "Xpress Intense"];

            e(() => {
                const hash = window.location.hash.slice(1);
                if (hash) { sH(hash); sLc(true); }
            }, []);

            e(() => {
                const d = { owned: p.filter(e => e.owned).map(e => e.id), toBuy: p.filter(e => e.toBuy).map(e => e.id) };
                localStorage.setItem('vallejo-paint-data', JSON.stringify(d));
            }, [p]);

            e(() => {
                const k = (ev) => {
                    if (ev.key === 'Escape') {
                        if (sm) { sSm(false); sMc(''); }
                        if (lc) handleCaL();
                        if (rc) handleCaR();
                        if (f) sF(false);
                        if (hl) sHl(false);
                    }
                };
                window.addEventListener('keydown', k);
                return () => window.removeEventListener('keydown', k);
            }, [sm, lc, rc, f, hl]);

            e(() => {
                if (!f) return;
                const click = (ev) => {
                    const d = document.getElementById('filter-dropdown'), b = document.getElementById('filter-dropdown-button');
                    if (d && b && !d.contains(ev.target) && !b.contains(ev.target)) sF(false);
                };
                document.addEventListener('mousedown', click);
                return () => document.removeEventListener('mousedown', click);
            }, [f]);

            const hO = c((id, checked) => {
                sP(prev => prev.map(e => e.id === id ? { ...e, owned: checked, toBuy: checked ? false : e.toBuy } : e));
            }, []);

            const hW = c((id, checked) => {
                sP(prev => prev.map(e => e.id === id ? { ...e, toBuy: checked } : e));
            }, []);

            const hOF = c((checked) => {
                sFl(prev => ({ ...prev, owned: checked, notOwned: checked ? false : prev.notOwned }));
            }, []);

            const hNF = c((checked) => {
                sFl(prev => ({ ...prev, notOwned: checked, owned: checked ? false : prev.owned }));
            }, []);

            const hWF = c((checked) => {
                sFl(prev => ({ ...prev, toBuy: checked }));
            }, []);

            const hE = c(() => {
                const d = { owned: p.filter(e => e.owned).map(e => e.id), toBuy: p.filter(e => e.toBuy).map(e => e.id) };
                const dataStr = JSON.stringify(d, null, 2);
                const uri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const link = document.createElement('a');
                link.setAttribute('href', uri);
                link.setAttribute('download', 'vallejo-paints.json');
                link.click();
            }, [p]);

            const hI = c((ev) => {
                const file = ev.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const imp = JSON.parse(e.target.result);
                        if (!imp.owned || !Array.isArray(imp.owned)) throw new Error('Invalid format');
                        const o = new Set(imp.owned), t = new Set(imp.toBuy || []);
                        sP(prev => prev.map(e => ({ ...e, owned: o.has(e.id), toBuy: t.has(e.id) })));
                        alert('Data imported successfully!');
                    } catch (error) {
                        alert('Error importing data: ' + error.message);
                    }
                };
                reader.readAsText(file);
                ev.target.value = '';
            }, []);

            const hR = c(() => sRc(true), []);
            const hCR = c(() => { sP(prev => prev.map(e => ({ ...e, owned: false, toBuy: false }))); localStorage.removeItem('vallejo-paint-data'); sRc(false); }, []);
            const handleCaR = c(() => sRc(false), []);

            const hS = c(async () => {
                sSt('Creating share link...');
                try {
                    const enc = ep(p);
                    const url = `${window.location.origin}${window.location.pathname}#${enc}`;
                    await navigator.clipboard.writeText(url);
                    sSt(`✓ Link copied! (${url.length} chars)`);
                    setTimeout(() => sSt(''), 5000);
                } catch (error) {
                    sSt(`✗ Error: ${error.message}`);
                    setTimeout(() => sSt(''), 5000);
                }
            }, [p]);

            const lH = c((data) => {
                sSt('Loading from URL...');
                try {
                    const dec = ds(data, p);
                    sP(dec);
                    sSt('✓ Loaded successfully!');
                    setTimeout(() => sSt(''), 3000);
                    window.history.replaceState(null, '', window.location.pathname);
                } catch (error) {
                    sSt(`✗ Error loading: ${error.message}`);
                    setTimeout(() => sSt(''), 5000);
                }
            }, [p]);

            const hM = c(() => {
                const code = mc.trim();
                if (code) { sH(code); sSm(false); sLc(true); sMc(''); } 
                else { sSt('✗ Please enter a code'); setTimeout(() => sSt(''), 3000); }
            }, [mc]);

            const hCL = c(() => { lH(h); sLc(false); sH(''); }, [h, lH]);
            const handleCaL = c(() => { sLc(false); sH(''); if (window.location.hash) window.history.replaceState(null, '', window.location.pathname); }, []);

            const fp = m(() => {
                let r = [...p];
                if (fl.owned) r = r.filter(e => e.owned);
                if (fl.notOwned) r = r.filter(e => !e.owned);
                if (fl.toBuy) r = r.filter(e => e.toBuy);
                if (s) {
                    const term = s.toLowerCase();
                    r = r.filter(e => e.name.toLowerCase().includes(term) || e.id.toLowerCase().includes(term));
                }
                return r;
            }, [p, fl, s]);

            const gp = m(() => {
                if (s) return { "Search Results": fp };
                const g = {};
                pt.forEach(type => {
                    const tp = fp.filter(e => e.type === type);
                    if (tp.length > 0) g[type] = tp;
                });
                return g;
            }, [fp, s]);

            const stats = m(() => ({
                owned: p.filter(e => e.owned).length,
                toBuy: p.filter(e => e.toBuy).length,
                total: p.length
            }), [p]);

            const typeNames = {
                "Regular": "Game Color", "Metallic": "Game Color Metallic", "Ink": "Game Color Ink",
                "Wash": "Game Color Wash", "Fluo": "Game Color Fluo", "Special FX": "Game Color Special FX",
                "Auxiliary": "Auxiliary Products", "Xpress": "Xpress Color", "Xpress Intense": "Xpress Color Intense"
            };

            return React.createElement('div', { className: 'max-w-7xl mx-auto p-4' },
                React.createElement('div', { className: 'mb-4 flex justify-between items-center gap-3' },
                    React.createElement('h1', { className: 'text-2xl sm:text-3xl font-bold' }, 'Paint Tracker'),
                    React.createElement('div', { className: 'flex gap-2 flex-wrap' },
                        React.createElement('span', { className: 'bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs sm:text-sm whitespace-nowrap' }, `Owned: ${stats.owned}/${stats.total}`),
                        React.createElement('span', { className: 'bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs sm:text-sm whitespace-nowrap' }, `Wishlist: ${stats.toBuy}`)
                    )
                ),
                React.createElement('div', { className: 'mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-4' },
                    React.createElement('div', { className: 'flex gap-2 flex-1 min-w-0' },
                        React.createElement('input', {
                            type: 'text', placeholder: 'Search...', value: s, onChange: (e) => sS(e.target.value),
                            className: 'flex-1 min-w-0 p-2 border rounded', 'aria-label': 'Search paints'
                        }),
                        React.createElement('div', { className: 'relative flex-shrink-0' },
                            React.createElement('button', {
                                id: 'filter-dropdown-button', onClick: () => sF(!f), className: 'px-3 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 whitespace-nowrap',
                                'aria-expanded': f, 'aria-haspopup': true
                            }, 'Filters ▾'),
                            f && React.createElement('div', { id: 'filter-dropdown', className: 'absolute top-full mt-1 right-0 bg-white border border-gray-300 rounded-lg shadow-lg p-3 z-50 min-w-[200px]', role: 'menu' },
                                React.createElement('div', { className: 'flex flex-col gap-2' },
                                    React.createElement('label', { className: 'flex items-center hover:bg-gray-50 p-2 rounded cursor-pointer' },
                                        React.createElement('input', { type: 'checkbox', checked: fl.owned, onChange: (e) => hOF(e.target.checked), className: 'mr-2' }),
                                        React.createElement('span', { className: 'text-sm' }, 'Owned')
                                    ),
                                    React.createElement('label', { className: 'flex items-center hover:bg-gray-50 p-2 rounded cursor-pointer' },
                                        React.createElement('input', { type: 'checkbox', checked: fl.notOwned, onChange: (e) => hNF(e.target.checked), className: 'mr-2' }),
                                        React.createElement('span', { className: 'text-sm' }, 'Missing')
                                    ),
                                    React.createElement('label', { className: 'flex items-center hover:bg-gray-50 p-2 rounded cursor-pointer' },
                                        React.createElement('input', { type: 'checkbox', checked: fl.toBuy, onChange: (e) => hWF(e.target.checked), className: 'mr-2' }),
                                        React.createElement('span', { className: 'text-sm' }, 'Wishlist')
                                    ),
                                    React.createElement('div', { className: 'border-t border-gray-200 my-1' }),
                                    React.createElement('label', { className: 'flex items-center hover:bg-gray-50 p-2 rounded cursor-pointer' },
                                        React.createElement('input', { type: 'checkbox', checked: t, onChange: (e) => sT(e.target.checked), className: 'mr-2' }),
                                        React.createElement('span', { className: 'text-sm' }, 'BSL Triads')
                                    )
                                )
                            )
                        )
                    ),
                    React.createElement('div', { className: 'flex gap-2 flex-wrap justify-center sm:justify-start' },
                        React.createElement('button', { onClick: hS, className: 'px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 whitespace-nowrap', title: 'Create shareable link' }, 'Share'),
                        React.createElement('button', { onClick: () => sSm(true), className: 'px-3 py-2 bg-teal-600 text-white rounded hover:bg-teal-700 whitespace-nowrap', title: 'Load from code' }, 'Load'),
                        React.createElement('button', { onClick: hE, className: 'px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 whitespace-nowrap', title: 'Export to JSON' }, 'Export'),
                        React.createElement('label', { className: 'px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 cursor-pointer whitespace-nowrap' },
                            'Import', React.createElement('input', { type: 'file', accept: '.json', onChange: hI, className: 'hidden', 'aria-label': 'Import JSON' })
                        ),
                        React.createElement('button', { onClick: hR, className: 'px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 whitespace-nowrap', title: 'Reset all data' }, 'Reset')
                    )
                ),
                st && React.createElement('div', { className: 'mb-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm', role: 'status' }, st),
                sm && React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50', role: 'dialog', 'aria-modal': 'true' },
                    React.createElement('div', { className: 'bg-white rounded-lg p-6 max-w-md w-full' },
                        React.createElement('h3', { className: 'text-lg font-bold mb-4' }, 'Load from Code'),
                        React.createElement('p', { className: 'text-sm text-gray-600 mb-4' }, 'Paste the code from your shared URL:'),
                        React.createElement('input', {
                            type: 'text', value: mc, onChange: (e) => sMc(e.target.value), placeholder: 'Paste code here...',
                            className: 'w-full p-2 border rounded mb-4 font-mono text-xs', autoFocus: true
                        }),
                        React.createElement('div', { className: 'flex gap-2 justify-end' },
                            React.createElement('button', { onClick: () => { sSm(false); sMc(''); }, className: 'px-4 py-2 bg-gray-300 rounded hover:bg-gray-400' }, 'Cancel'),
                            React.createElement('button', { onClick: hM, className: 'px-4 py-2 bg-teal-600 text-white rounded hover:bg-teal-700' }, 'Load')
                        )
                    )
                ),
                lc && React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50', role: 'dialog', 'aria-modal': 'true' },
                    React.createElement('div', { className: 'bg-white rounded-lg p-6 max-w-md w-full' },
                        React.createElement('h3', { className: 'text-lg font-bold mb-4' }, '⚠️ Overwrite Collection?'),
                        React.createElement('p', { className: 'text-sm text-gray-600 mb-4' }, 'Loading will replace your current data. Export first if you want to keep it.'),
                        React.createElement('div', { className: 'flex gap-2 justify-end' },
                            React.createElement('button', { onClick: handleCaL, className: 'px-4 py-2 bg-gray-300 rounded hover:bg-gray-400' }, 'Cancel'),
                            React.createElement('button', { onClick: hCL, className: 'px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700' }, 'Replace My Data')
                        )
                    )
                ),
                rc && React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50', role: 'dialog', 'aria-modal': 'true' },
                    React.createElement('div', { className: 'bg-white rounded-lg p-6 max-w-md w-full' },
                        React.createElement('h3', { className: 'text-lg font-bold mb-4' }, '⚠️ Reset All Data?'),
                        React.createElement('p', { className: 'text-sm text-gray-600 mb-4' }, 'This will clear all your data. Export first for backup.'),
                        React.createElement('div', { className: 'flex gap-2 justify-end' },
                            React.createElement('button', { onClick: handleCaR, className: 'px-4 py-2 bg-gray-300 rounded hover:bg-gray-400' }, 'Cancel'),
                            React.createElement('button', { onClick: hCR, className: 'px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700' }, 'Reset Everything')
                        )
                    )
                ),
                t && React.createElement('div', { className: 'mb-6 paint-group' },
                    React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 'BSL Triads'),
                    React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2' },
                        window.triads.map((triad, idx) => {
                            const ownedCount = triad.filter(id => p.find(e => e.id === id)?.owned).length;
                            const bgColor = ownedCount === 3 ? 'bg-green-100' : ownedCount === 2 ? 'bg-yellow-100' : 'bg-white';
                            return React.createElement('div', { key: idx, className: `${bgColor} border border-gray-200 rounded p-2` },
                                React.createElement('div', { className: 'grid grid-cols-3 gap-2' },
                                    triad.map((paintId) => {
                                        const paint = p.find(e => e.id === paintId);
                                        if (!paint) return React.createElement('div', { key: `${idx}-${paintId}`, className: 'paint-swatch' },
                                            React.createElement('span', { className: 'text-xs text-gray-500' }, 'Missing'));
                                        return React.createElement('div', { key: `${idx}-${paintId}`, className: 'paint-swatch' },
                                            React.createElement('div', { className: 'color-block mb-1', style: { backgroundColor: paint.color }, title: paint.name }),
                                            React.createElement('div', { className: 'text-xs font-semibold' }, paint.id),
                                            React.createElement('div', { className: 'text-xs truncate', title: paint.name }, paint.name),
                                            React.createElement('div', { className: 'text-xs text-gray-500 truncate', title: paint.citadel }, paint.citadel || "N/A"),
                                            React.createElement('div', { className: 'flex gap-2 mt-1' },
                                                React.createElement('label', { className: 'text-xs flex items-center' },
                                                    React.createElement('input', { type: 'checkbox', checked: paint.owned, onChange: (e) => hO(paint.id, e.target.checked), className: 'mr-1' }),
                                                    'Own'
                                                ),
                                                React.createElement('label', { className: 'text-xs flex items-center' },
                                                    React.createElement('input', { type: 'checkbox', checked: paint.toBuy, disabled: paint.owned, onChange: (e) => hW(paint.id, e.target.checked), className: 'mr-1' }),
                                                    'Buy'
                                                )
                                            )
                                        );
                                    })
                                )
                            );
                        })
                    )
                ),
                React.createElement('div', null,
                    Object.entries(gp).map(([type, typePaints]) =>
                        React.createElement('div', { key: type, className: 'paint-group' },
                            React.createElement('h2', { className: 'text-xl font-bold mb-4' }, typeNames[type] || type),
                            React.createElement('div', { className: 'grid grid-cols-3 sm:grid-cols-3 md:grid-cols-6 lg:grid-cols-9 gap-2' },
                                typePaints.map(paint =>
                                    React.createElement('div', { key: paint.id, className: 'paint-swatch' },
                                        React.createElement('div', { className: 'color-block mb-1', style: { backgroundColor: paint.color }, title: paint.name }),
                                        React.createElement('div', { className: 'text-xs font-semibold' }, paint.id),
                                        React.createElement('div', { className: 'text-xs truncate', title: paint.name }, paint.name),
                                        React.createElement('div', { className: 'text-xs text-gray-500 truncate', title: paint.citadel }, paint.citadel || "N/A"),
                                        React.createElement('div', { className: 'flex gap-2 mt-1' },
                                            React.createElement('label', { className: 'text-xs flex items-center' },
                                                React.createElement('input', { type: 'checkbox', checked: paint.owned, onChange: (e) => hO(paint.id, e.target.checked), className: 'mr-1' }),
                                                'Own'
                                            ),
                                            React.createElement('label', { className: 'text-xs flex items-center' },
                                                React.createElement('input', { type: 'checkbox', checked: paint.toBuy, disabled: paint.owned, onChange: (e) => hW(paint.id, e.target.checked), className: 'mr-1' }),
                                                'Buy'
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
            );
        }

        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
